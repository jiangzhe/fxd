package fxd

import (
	"fmt"
	"testing"
)

func TestDecimalFromString(t *testing.T) {
	var fd FixedDecimal
	for _, s := range []string{
		"0",
		"1",
		"-1",
		"123",
		"123456789012345",
		"0.1",
		"0.123",
		"1.0",
		"-1.0",
		"1E1",
		"1E+2",
		"1.0E-2",
		"1.0e10",
	} {
		if err := DecimalFromBytesString([]byte(s), &fd); err != nil {
			t.Fatal("failed")
		}
		fmt.Printf("input=%v, result=%v\n", s, fd)
	}
}

func TestDecimalToString(t *testing.T) {
	type tscase struct {
		input    string
		expected string
	}

	var fd FixedDecimal
	for _, c := range []tscase{
		{"0", "0"},
		{"1", "1"},
		{"-1", "-1"},
		{"+1", "1"},
		{"123", "123"},
		{"123456789012345", "123456789012345"},
		{"0.0", "0.0"},
		{"0.100", "0.100"},
		{"0.1", "0.1"},
		{"0.12345678901234567890", "0.12345678901234567890"},
		{"0.123", "0.123"},
		{"1.0", "1.0"},
		{"-1.0", "-1.0"},
		{"1e0", "1"},
		{"1E1", "10"},
		{"1E+2", "100"},
		{"1.0E-2", "0.010"},
		{"1.0e10", "10000000000"},
		{"1.2345e20", "123450000000000000000"},
		{"5.4433e4", "54433"},
		{"5.4433e3", "5443.3"},
		{"5.4433e2", "544.33"},
		{"5.4433e1", "54.433"},
		{"5.4433e0", "5.4433"},
		{"5.4433e-1", "0.54433"},
		{"5.4433e-2", "0.054433"},
		{"5.4433e-3", "0.0054433"},
		{"5.4433e-5", "0.000054433"},
		{"5.4433e-6", "0.0000054433"},
		{"5.4433e-7", "0.00000054433"},
		{"5.4433e-8", "0.000000054433"},
		{"5.4433e-9", "0.0000000054433"},
		{"5.4433e-10", "0.00000000054433"},
		{"5.4433e-11", "0.000000000054433"},
		{"5.4433e-20", "0.000000000000000000054433"},
		{"Inf", "Infinity"},
		{"NaN", "NaN"},
	} {
		if err := DecimalFromBytesString([]byte(c.input), &fd); err != nil {
			t.Fatalf("failed %v", err)
		}
		actual := fd.ToString(-1)
		if actual != c.expected {
			t.Fatalf("result mismatch: actual=%v, expected=%v", actual, c.expected)
		}
	}
}

func TestDecimalAdd(t *testing.T) {
	type tcase struct {
		input1, input2, expected string
	}
	var fd1 FixedDecimal
	var fd2 FixedDecimal
	var fd3 FixedDecimal
	for _, c := range []tcase{
		{"0", "0", "0"},
		{"0", "1", "1"},
		{"1", "1", "2"},
		{"1", "-1", "0"},
		{"-1", "1", "0"},
		{"-1", "-100", "-101"},
		{"5", "5", "10"},
		{"1.0", "0", "1.0"},
		{"1.0", "0.0", "1.0"},
		{"-1.0", "0.01", "-0.99"},
		{"-0.3", "1.27", "0.97"},
		{"-0.3", "0.2", "-0.1"},
		{"-0.01", "0.001", "-0.009"},
		{"-123", "0.1", "-122.9"},
		{"1", "-12.5", "-11.5"},
		{"-5.0", "5.0", "0"},
		{"1.0", "0.1", "1.1"},
		{"1.01", "0.1", "1.11"},
		{"1.00000000001", "1000.01", "1001.01000000001"},
		{"1.234567890", "0.0000000001", "1.2345678901"},
		{"-1.234567890", "0.0000000001", "-1.2345678899"},
	} {
		if err := DecimalFromAsciiString(c.input1, &fd1); err != nil {
			t.Fatalf("failed %v", err)
		}
		if err := DecimalFromAsciiString(c.input2, &fd2); err != nil {
			t.Fatalf("failed %v", err)
		}
		if err := DecimalAdd(&fd1, &fd2, &fd3); err != nil {
			t.Fatalf("failed %v", err)
		}
		actual := fd3.ToString(-1)
		fmt.Printf("%v+%v=%v, intg=%v, frac=%v\n", fd1.ToString(-1), fd2.ToString(-1), actual, fd3.Intg(), fd3.Frac())
		if actual != c.expected {
			t.Fatalf("result mismatch")
		}
	}
}

func TestDecimalSub(t *testing.T) {
	type tcase struct {
		input1, input2, expected string
	}
	var fd1 FixedDecimal
	var fd2 FixedDecimal
	var fd3 FixedDecimal
	for _, c := range []tcase{
		{"0", "0", "0"},
		{"0", "1", "-1"},
		{"1", "0", "1"},
		{"1", "1", "0"},
		{"1", "2", "-1"},
		{"2", "1", "1"},
		{"1", "-1", "2"},
		{"-1", "1", "-2"},
		{"-1", "-100", "99"},
		{"1.0", "0", "1.0"},
		{"1.0", "0.0", "1.0"},
		{"-1.0", "0.01", "-1.01"},
		{"-0.3", "1.27", "-1.57"},
		{"-0.3", "-0.2", "-0.1"},
		{"-0.3", "0.2", "-0.5"},
		{"-0.01", "0.001", "-0.011"},
		{"-123", "0.1", "-123.1"},
		{"1", "-12.5", "13.5"},
		{"-5.0", "5.0", "-10.0"},
		{"1.0", "0.1", "0.9"},
		{"1.01", "0.1", "0.91"},
		{"1.00000000001", "1000.01", "-999.00999999999"},
		{"1.234567890", "0.0000000001", "1.2345678899"},
		{"-1.234567890", "0.0000000001", "-1.2345678901"},
	} {
		if err := DecimalFromAsciiString(c.input1, &fd1); err != nil {
			t.Fatalf("failed %v", err)
		}
		if err := DecimalFromAsciiString(c.input2, &fd2); err != nil {
			t.Fatalf("failed %v", err)
		}
		if err := DecimalSub(&fd1, &fd2, &fd3); err != nil {
			t.Fatalf("failed %v", err)
		}
		actual := fd3.ToString(-1)
		fmt.Printf("%v-%v=%v\n", fd1.ToString(-1), fd2.ToString(-1), actual)
		if actual != c.expected {
			t.Fatalf("result mismatch")
		}
	}
}

func TestDecimalMul(t *testing.T) {
	type tcase struct {
		input1, input2, expected string
	}
	var fd1 FixedDecimal
	var fd2 FixedDecimal
	var fd3 FixedDecimal
	for _, c := range []tcase{
		{"0", "0", "0"},
		{"0", "1", "0"},
		{"1", "0", "0"},
		{"1", "1", "1"},
		{"1", "2", "2"},
		{"2", "1", "2"},
		{"1", "-1", "-1"},
		{"-1", "1", "-1"},
		{"-1", "-100", "100"},
		{"1.0", "0", "0"},
		{"1.0", "0.0", "0.00"},
		{"-1.0", "0.01", "-0.010"},
		{"-0.3", "1.27", "-0.381"},
		{"-0.3", "-0.2", "0.06"},
		{"-0.3", "0.2", "-0.06"},
		{"-0.01", "0.001", "-0.00001"},
		{"-0.10", "0.001", "-0.00010"},
		{"-123", "0.1", "-12.3"},
		{"1", "-12.5", "-12.5"},
		{"-5.0", "5.0", "-25.00"},
		{"1.0", "0.1", "0.10"},
		{"1.01", "0.1", "0.101"},
		{"1.00000000001", "1000.01", "1000.0100000100001"},
		{"1.234567890", "0.0000000001", "0.0000000001234567890"},
		{"-1.234567890", "0.0000000001", "-0.0000000001234567890"},
	} {
		if err := DecimalFromAsciiString(c.input1, &fd1); err != nil {
			t.Fatalf("failed %v", err)
		}
		if err := DecimalFromAsciiString(c.input2, &fd2); err != nil {
			t.Fatalf("failed %v", err)
		}
		if err := DecimalMul(&fd1, &fd2, &fd3); err != nil {
			t.Fatalf("failed %v", err)
		}
		actual := fd3.ToString(-1)
		fmt.Printf("%v*%v=%v\n", fd1.ToString(-1), fd2.ToString(-1), actual)
		if actual != c.expected {
			t.Fatalf("result mismatch")
		}
	}
}

func TestDecimalDiv(t *testing.T) {
	type tcase struct {
		input1, input2, expected string
	}
	var fd1 FixedDecimal
	var fd2 FixedDecimal
	var fd3 FixedDecimal
	for _, c := range []tcase{
		{"0", "1", "0"},
		{"1", "1", "1.000000000"}, // incremental frac is already multiple of 9
		{"1", "1", "1.000000000"},
		{"1", "2", "0.500000000"},
		{"2", "1", "2.000000000"},
		{"1", "-1", "-1.000000000"},
		{"-1", "1", "-1.000000000"},
		{"-1", "-100", "0.010000000"},
		{"100", "1", "100.000000000"},
		{"100", "100", "1.000000000"},
		{"1.0", "2", "0.500000000"},
		{"1.0", "2.0", "0.500000000000000000"}, // two fractional units
		{"-1", "0.01", "-100.000000000"},
		{"0.27", "0.3", "0.900000000000000000"},
		{"-0.3", "-0.2", "1.500000000000000000"},
		{"0.3", "0.7", "0.428571428571428571"},
		{"0.6", "0.9", "0.666666666666666666"},
		{"-0.3", "0.2", "-1.500000000000000000"},
		{"1000000000.1", "7", "142857142.871428571"},
		{"1000000000.1", "9", "111111111.122222222"},
		{"101000000000.1", "7", "14428571428.585714285"},
		{"101000000000.1", "7.1", "14225352112.690140845070422535"},
		{"101000000000.1", "5", "20200000000.020000000"},
		{"101000000000.1", "5.0", "20200000000.020000000000000000"},
		{"100.10000000001", "7", "14.300000000001428571"},
		{"100.10000000001", "7.0", "14.300000000001428571428571428"},
		{"100.1", "7.0000000001", "14.299999999795714285717204081"},
		{"205.6", "9.5000000001", "21.642105262930083102495472809"},
		{"2000000005.1", "7.5000000001", "266666667.343111111102091851851972108"},
		{"1.2", "0.7", "1.714285714285714285"},
		{"1.22", "0.77", "1.584415584415584415"},
		{"1.222", "0.777", "1.572715572715572715"},
		{"1.2222", "0.7777", "1.571557155715571557"},
		{"1.22222", "0.77777", "1.571441428700001285"},
		{"1.222222", "0.777777", "1.571429857144142858"},
		{"1.2222222", "0.7777777", "1.571428700000012857"},
		{"1.22222222", "0.77777777", "1.571428584285714414285715571"},
		{"1.222222222", "0.777777777", "1.571428572714285715571428572"},
		{"9.8", "1", "9.800000000"},
		{"98.7", "1.2", "82.250000000000000000"},
		{"987.6", "12.3", "80.292682926829268292"},
		{"9876.5", "123.4", "80.036466774716369529"},
		{"98765.4", "1234.5", "80.004374240583232077"},
		{"987654.3", "12345.6", "80.000510303265940902"},
		{"9876543.2", "123456.7", "80.000058320042573631"},
		{"98765432.1", "1234567.8", "80.000006561000538002"},
		{"987654321.1", "12345678.9", "80.000000737100006707"},
		{"987654321.12", "12345678.99", "80.000000155520000281"},
		{"987654321.123", "12345678.998", "80.000000103923000120"},
		{"987654321.1234", "12345678.9987", "80.000000099419400109"},
		{"987654321.12345", "12345678.99876", "80.000000099034650108"},
		{"987654321.123456", "12345678.998765", "80.000000099002736108"},
		{"987654321.1234567", "12345678.9987654", "80.000000099000200808"},
		{"987654321.12345678", "12345678.99876543", "80.000000099000012888900031007"},
		{"987654321.123456789", "12345678.998765432", "80.000000099000000657900001515"},
		{"-9.8", "1", "-9.800000000"},
		{"-98.7", "1.2", "-82.250000000000000000"},
		{"-987.6", "12.3", "-80.292682926829268292"},
		{"-9876.5", "123.4", "-80.036466774716369529"},
		{"-98765.4", "1234.5", "-80.004374240583232077"},
		{"-987654.3", "12345.6", "-80.000510303265940902"},
		{"-9876543.2", "123456.7", "-80.000058320042573631"},
		{"-98765432.1", "1234567.8", "-80.000006561000538002"},
		{"-987654321.1", "12345678.9", "-80.000000737100006707"},
		{"-987654321.12", "12345678.99", "-80.000000155520000281"},
		{"-987654321.123", "12345678.998", "-80.000000103923000120"},
		{"-987654321.1234", "12345678.9987", "-80.000000099419400109"},
		{"-987654321.12345", "12345678.99876", "-80.000000099034650108"},
		{"-987654321.123456", "12345678.998765", "-80.000000099002736108"},
		{"-987654321.1234567", "12345678.9987654", "-80.000000099000200808"},
		{"-987654321.12345678", "12345678.99876543", "-80.000000099000012888900031007"},
		{"-987654321.123456789", "12345678.998765432", "-80.000000099000000657900001515"},
		{"0.170511", "-353390023.459963", "-0.000000000482500887"},
		{"0.170511", "-353390023", "-0.000000000482500888"},
	} {
		if err := DecimalFromAsciiString(c.input1, &fd1); err != nil {
			t.Fatalf("failed %v", err)
		}
		if err := DecimalFromAsciiString(c.input2, &fd2); err != nil {
			t.Fatalf("failed %v", err)
		}
		if err := DecimalDiv(&fd1, &fd2, &fd3, 4); err != nil {
			t.Fatalf("failed %v", err)
		}
		actual := fd3.ToString(-1)
		fmt.Printf("fd1=%v, fd2=%v\n", fd1, fd2)
		fmt.Printf("%v/%v=%v\n", fd1.ToString(-1), fd2.ToString(-1), actual)
		if actual != c.expected {
			t.Fatalf("result mismatch")
		}
	}
}

func TestDecimalCompare(t *testing.T) {
	type tcase struct {
		input1, input2 string
		expected       int
	}
	var fd1 FixedDecimal
	var fd2 FixedDecimal
	for _, c := range []tcase{
		{"0", "0", 0},
		{"0", "1", -1},
		{"1", "0", 1},
		{"1", "1", 0},
		{"2", "1", 1},
		{"1", "2", -1},
		{"1.0", "1", 0},
		{"1", "1.0", 0},
		{"1.000", "1.00", 0},
		{"1.000000000000", "1.00000", 0},
		{"1.01", "1", 1},
		{"1", "1.01", -1},
		{"1.02", "1.01", 1},
		{"1.01", "1.02", -1},
		{"1000000000", "999999999", 1},
		{"999999999", "1000000000", -1},
		{"1.0000000000000000000000000001", "1", 1},
		{"1", "1.0000000000000000000000000001", -1},
		{"1.0000000010000000000000000001", "1.0000000010000000000000000001", 0},
		{"1.0000000010000000000000000001", "1.0000000010000000000000000002", -1},
		{"1.0000000010000000000000000002", "1.0000000010000000000000000001", 1},
		{"1.0000000010000000010000000001", "1.0000000010000000010000000001", 0},
		{"1.0000000010000000010000000001", "1.0000000010000000010000000002", -1},
		{"1.0000000010000000010000000002", "1.0000000010000000010000000001", 1},
		{"100000000000000000000000000", "100000000000000000000000000", 0},
		{"100000000000000000000000001", "100000000000000000000000000", 1},
		{"100000000000000000000000000", "100000000000000000000000001", -1},
	} {
		if err := DecimalFromAsciiString(c.input1, &fd1); err != nil {
			t.Fatalf("failed %v", err)
		}
		if err := DecimalFromAsciiString(c.input2, &fd2); err != nil {
			t.Fatalf("failed %v", err)
		}
		actual := fd1.Compare(&fd2)
		fmt.Printf("(%v)compare(%v) = %v\n", fd1.ToString(-1), fd2.ToString(-1), actual)
		if actual != c.expected {
			t.Fatalf("result mismatch")
		}
	}
}

func TestDecimalRound(t *testing.T) {
	type tcase struct {
		input1   string
		frac     int
		expected string
	}
	var fd1 FixedDecimal
	var fd2 FixedDecimal
	for _, c := range []tcase{
		{"0", 0, "0"},
		{"0", 1, "0"},
		{"1", -1, "0"},
		{"1.00", 1, "1.000000000"},
		{"1.01", 1, "1.000000000"},
		{"1.02", 1, "1.000000000"},
		{"1.03", 1, "1.000000000"},
		{"1.04", 1, "1.000000000"},
		{"1.05", 1, "1.100000000"},
		{"1.06", 1, "1.100000000"},
		{"1.07", 1, "1.100000000"},
		{"1.08", 1, "1.100000000"},
		{"1.09", 1, "1.100000000"},
		{"1.050", 1, "1.100000000"},
		{"1.051", 1, "1.100000000"},
		{"1.052", 1, "1.100000000"},
		{"1.053", 1, "1.100000000"},
		{"1.054", 1, "1.100000000"},
		{"1.055", 1, "1.100000000"},
		{"1.056", 1, "1.100000000"},
		{"1.057", 1, "1.100000000"},
		{"1.058", 1, "1.100000000"},
		{"1.059", 1, "1.100000000"},
		{"1.040", 1, "1.000000000"},
		{"1.041", 1, "1.000000000"},
		{"1.042", 1, "1.000000000"},
		{"1.043", 1, "1.000000000"},
		{"1.044", 1, "1.000000000"},
		{"1.045", 1, "1.000000000"},
		{"1.046", 1, "1.000000000"},
		{"1.047", 1, "1.000000000"},
		{"1.048", 1, "1.000000000"},
		{"1.049", 1, "1.000000000"},
		{"1.0000000000", 9, "1.000000000"},
		{"1.0000000001", 9, "1.000000000"},
		{"1.0000000002", 9, "1.000000000"},
		{"1.0000000003", 9, "1.000000000"},
		{"1.0000000004", 9, "1.000000000"},
		{"1.0000000005", 9, "1.000000001"},
		{"1.0000000006", 9, "1.000000001"},
		{"1.0000000007", 9, "1.000000001"},
		{"1.0000000008", 9, "1.000000001"},
		{"1.0000000009", 9, "1.000000001"},
		{"1.0000000090", 9, "1.000000009"},
		{"1.0000000091", 9, "1.000000009"},
		{"1.0000000092", 9, "1.000000009"},
		{"1.0000000093", 9, "1.000000009"},
		{"1.0000000094", 9, "1.000000009"},
		{"1.0000000095", 9, "1.000000010"},
		{"1.0000000096", 9, "1.000000010"},
		{"1.0000000097", 9, "1.000000010"},
		{"1.0000000098", 9, "1.000000010"},
		{"1.0000000099", 9, "1.000000010"},
		{"999999999.0", 0, "999999999"},
		{"999999999.1", 0, "999999999"},
		{"999999999.2", 0, "999999999"},
		{"999999999.3", 0, "999999999"},
		{"999999999.4", 0, "999999999"},
		{"999999999.5", 0, "1000000000"},
		{"999999999.6", 0, "1000000000"},
		{"999999999.7", 0, "1000000000"},
		{"999999999.8", 0, "1000000000"},
		{"999999999.9", 0, "1000000000"},
		{"999999999.99990", 4, "999999999.999900000"},
		{"999999999.99991", 4, "999999999.999900000"},
		{"999999999.99992", 4, "999999999.999900000"},
		{"999999999.99993", 4, "999999999.999900000"},
		{"999999999.99994", 4, "999999999.999900000"},
		{"999999999.99995", 4, "1000000000.000000000"},
		{"999999999.99996", 4, "1000000000.000000000"},
		{"999999999.99997", 4, "1000000000.000000000"},
		{"999999999.99998", 4, "1000000000.000000000"},
		{"999999999.99999", 4, "1000000000.000000000"},
		{"999999999999999999.0", 0, "999999999999999999"},
		{"999999999999999999.1", 0, "999999999999999999"},
		{"999999999999999999.2", 0, "999999999999999999"},
		{"999999999999999999.3", 0, "999999999999999999"},
		{"999999999999999999.4", 0, "999999999999999999"},
		{"999999999999999999.5", 0, "1000000000000000000"},
		{"999999999999999999.6", 0, "1000000000000000000"},
		{"999999999999999999.7", 0, "1000000000000000000"},
		{"999999999999999999.8", 0, "1000000000000000000"},
		{"999999999999999999.9", 0, "1000000000000000000"},
		{"999999999999999999.90", 1, "999999999999999999.900000000"},
		{"999999999999999999.91", 1, "999999999999999999.900000000"},
		{"999999999999999999.92", 1, "999999999999999999.900000000"},
		{"999999999999999999.93", 1, "999999999999999999.900000000"},
		{"999999999999999999.94", 1, "999999999999999999.900000000"},
		{"999999999999999999.95", 1, "1000000000000000000.000000000"},
		{"999999999999999999.96", 1, "1000000000000000000.000000000"},
		{"999999999999999999.97", 1, "1000000000000000000.000000000"},
		{"999999999999999999.98", 1, "1000000000000000000.000000000"},
		{"999999999999999999.99", 1, "1000000000000000000.000000000"},
	} {
		if err := DecimalFromAsciiString(c.input1, &fd1); err != nil {
			t.Fatalf("failed %v", err)
		}
		fd1.RoundTo(&fd2, c.frac)
		actual := fd2.ToString(-1)
		fmt.Printf("(%v).Round(%v) = %v\n", fd1.ToString(-1), c.frac, actual)
		if actual != c.expected {
			t.Fatalf("result mismatch")
		}
		fd1.Round(c.frac)
		actual = fd1.ToString(-1)
		fmt.Printf("self.Round() = %v\n", actual)
		if actual != c.expected {
			t.Fatalf("result mismatch")
		}
	}
}

func TestDecimalFormat(t *testing.T) {
	type tscase struct {
		input    string
		frac     int
		expected string
	}

	var fd FixedDecimal
	for _, c := range []tscase{
		{"0", 0, "0"},
		{"1", 0, "1"},
		{"-1", 0, "-1"},
		{"1", 0, "1"},
		{"123", 0, "123"},
		{"123456789012345", 0, "123456789012345"},
		{"0.0", 0, "0"},
		{"0.0", 1, "0.0"},
		{"0.0", 2, "0.00"},
		{"0.0", 3, "0.000"},
		{"0.0", 4, "0.0000"},
		{"0.0", 5, "0.00000"},
		{"0.0", 6, "0.000000"},
		{"0.0", 7, "0.0000000"},
		{"0.0", 8, "0.00000000"},
		{"0.0", 9, "0.000000000"},
		{"0.0", 10, "0.0000000000"},
		{"0.0", 11, "0.00000000000"},
		{"0.0", 12, "0.000000000000"},
		{"0.123456789123456789", -1, "0.123456789123456789"},
		{"0.123456789123456789", 0, "0"},
		{"0.123456789123456789", 1, "0.1"},
		{"0.123456789123456789", 2, "0.12"},
		{"0.123456789123456789", 3, "0.123"},
		{"0.123456789123456789", 4, "0.1234"},
		{"0.123456789123456789", 5, "0.12345"},
		{"0.123456789123456789", 6, "0.123456"},
		{"0.123456789123456789", 7, "0.1234567"},
		{"0.123456789123456789", 8, "0.12345678"},
		{"0.123456789123456789", 9, "0.123456789"},
		{"0.123456789123456789", 10, "0.1234567891"},
		{"0.123456789123456789", 11, "0.12345678912"},
		{"0.123456789123456789", 12, "0.123456789123"},
		{"0.123456789123456789", 13, "0.1234567891234"},
		{"0.123456789123456789", 14, "0.12345678912345"},
		{"0.123456789123456789", 15, "0.123456789123456"},
		{"0.123456789123456789", 16, "0.1234567891234567"},
		{"0.123456789123456789", 17, "0.12345678912345678"},
		{"0.123456789123456789", 18, "0.123456789123456789"},
		{"123456789123456789", -1, "123456789123456789"},
		{"123456789123456789", 0, "123456789123456789"},
		{"123456789123456789", 1, "123456789123456789.0"},
		{"123456789123456789", 2, "123456789123456789.00"},
		{"123456789123456789", 3, "123456789123456789.000"},
		{"123456789123456789", 4, "123456789123456789.0000"},
		{"123456789123456789", 5, "123456789123456789.00000"},
		{"123456789123456789", 6, "123456789123456789.000000"},
		{"123456789123456789", 7, "123456789123456789.0000000"},
		{"123456789123456789", 8, "123456789123456789.00000000"},
		{"123456789123456789", 9, "123456789123456789.000000000"},
		{"123456789123456789", 10, "123456789123456789.0000000000"},
		{"123456789123456789", 11, "123456789123456789.00000000000"},
		{"123456789123456789", 12, "123456789123456789.000000000000"},
		{"123456789123456789", 13, "123456789123456789.0000000000000"},
		{"123456789123456789", 14, "123456789123456789.00000000000000"},
		{"123456789123456789", 15, "123456789123456789.000000000000000"},
		{"123456789123456789", 16, "123456789123456789.0000000000000000"},
		{"123456789123456789", 17, "123456789123456789.00000000000000000"},
		{"123456789123456789", 18, "123456789123456789.000000000000000000"},
		{"123456789123456789", 19, "123456789123456789.0000000000000000000"},
	} {
		if err := DecimalFromBytesString([]byte(c.input), &fd); err != nil {
			t.Fatalf("failed %v", err)
		}
		actual := fd.ToString(c.frac)
		if actual != c.expected {
			t.Fatalf("result mismatch: actual=%v, expected=%v", actual, c.expected)
		}
	}
}

func TestDecimalNormal(t *testing.T) {
	var dec FixedDecimal
	if err := DecimalFromAsciiString("-100", &dec); err != nil {
		t.Fatal("failed")
	}
	dec.setNormal()
	if !dec.IsNeg() {
		t.Fatal("failed")
	}
}
